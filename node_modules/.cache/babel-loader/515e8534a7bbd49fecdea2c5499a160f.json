{"ast":null,"code":"var _jsxFileName = \"D:\\\\Pro\\\\React\\\\tlt\\\\src\\\\components\\\\Buildings\\\\Building.js\";\nimport React from 'react';\nimport { connect } from 'react-redux'; //import _ from 'lodash';\n\nimport { fetchBuilding, selectPawn, changeMessage, selectSquare } from './../actions';\nimport data from './buildings.json';\nimport { message, GAME_PHASE, SCORING_PHASE } from './../constants';\nimport { calcScore } from './scoring';\nimport { rotateAndMirrorPattern } from './patternHandler';\nimport preparedPattern from './../trash/preparePattern';\nimport _ from 'lodash';\n\nclass Building extends React.Component {\n  selectBuilding() {\n    ///ДУБЛИРУЕТСЯ С КОДОМ ВЫШЕ - отличие в том, что тут берется только title от объекта!!!\n    const pointToIndex = arr => {\n      //move to x=1, y=1\n      const dx = Math.min(...arr.map(point => Number(point.x))) - 1;\n      const dy = Math.min(...arr.map(point => Number(point.y))) - 1;\n      arr.forEach(point => {\n        point.x -= dx;\n        point.y -= dy;\n      }); //[{x: \"1\", y: \"2\", resource: \"WOOD\"},...] -> [[12,\"WOOD\"],...]\n\n      return arr.map(point => {\n        const index = point.x.toString() + point.y.toString();\n        return [index, point.resource.title]; //and sort by index\n      }).sort((a, b) => {\n        return a[0] - b[0];\n      });\n    };\n\n    if (this.props.phase === GAME_PHASE) {\n      const pp = preparedPattern(this.props.selectedPattern, this.props.board);\n      const ppp = pointToIndex(pp);\n      let canSelectPawn = this.props.building.patterns.find(pattern => _.isEqual(pattern, ppp));\n\n      if (canSelectPawn) {\n        this.props.changeMessage(message.patternMatchesBuilding(this.props.building.title));\n        this.props.selectPawn(this.props.building);\n      } else {\n        this.props.selectPawn({});\n        this.props.selectSquare(null);\n        this.props.changeMessage(message.patternDoesNotMatchBuilding(this.props.building.title));\n      }\n    }\n  }\n\n  componentDidMount() {\n    //upload data from json\n    const buildingForFetching = data[this.props.title]; //add all variants of the pattern\n\n    buildingForFetching.patterns = rotateAndMirrorPattern(buildingForFetching.pattern); //load Building to the state\n\n    this.props.fetchBuilding(buildingForFetching);\n  }\n\n  renderScoring() {\n    if (this.props.phase === SCORING_PHASE) {\n      return calcScore[this.props.building.title](this.props.board);\n    }\n\n    ;\n  }\n\n  renderPattern() {\n    const style = (col, row) => {\n      return {\n        gridColumn: col,\n        gridRow: row\n      };\n    };\n\n    return React.createElement(React.Fragment, null, this.props.building.pattern.map(resource => React.createElement(\"div\", {\n      key: resource[0],\n      className: \"resource \".concat(resource[1].toLowerCase()),\n      style: style(resource[0] % 10, Math.floor(resource[0] / 10)),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 79\n      },\n      __self: this\n    })));\n  }\n\n  render() {\n    if (!this.props.building) {\n      return null;\n    } else {\n      return React.createElement(\"div\", {\n        className: \"building\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 93\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"buildingTitle\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 94\n        },\n        __self: this\n      }, this.props.building.title, React.createElement(\"img\", {\n        src: \"/images/\".concat(this.props.building.type, \".png\"),\n        alt: this.props.building.type,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 95\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"buildingPattern\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 97\n        },\n        __self: this\n      }, \" \", this.renderPattern(), \" \"), React.createElement(\"div\", {\n        className: \"buildingAbility\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 98\n        },\n        __self: this\n      }, this.props.building.ability, \" \"), React.createElement(\"button\", {\n        onClick: () => this.selectBuilding(),\n        disabled: !(this.props.selectedPattern.length === this.props.building.pattern.length),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 99\n        },\n        __self: this\n      }, \"Check the pattern\"), this.renderScoring());\n    }\n  }\n\n}\n\n;\n\nconst mapStateToProps = (state, ownProps) => {\n  return {\n    phase: state.phase,\n    building: state.buildings[ownProps.index],\n    selectedPattern: state.selectedPattern,\n    board: state.board\n  };\n};\n\nexport default connect(mapStateToProps, {\n  fetchBuilding,\n  selectPawn,\n  changeMessage,\n  selectSquare\n})(Building);","map":{"version":3,"sources":["D:\\Pro\\React\\tlt\\src\\components\\Buildings\\Building.js"],"names":["React","connect","fetchBuilding","selectPawn","changeMessage","selectSquare","data","message","GAME_PHASE","SCORING_PHASE","calcScore","rotateAndMirrorPattern","preparedPattern","_","Building","Component","selectBuilding","pointToIndex","arr","dx","Math","min","map","point","Number","x","dy","y","forEach","index","toString","resource","title","sort","a","b","props","phase","pp","selectedPattern","board","ppp","canSelectPawn","building","patterns","find","pattern","isEqual","patternMatchesBuilding","patternDoesNotMatchBuilding","componentDidMount","buildingForFetching","renderScoring","renderPattern","style","col","row","gridColumn","gridRow","toLowerCase","floor","render","type","ability","length","mapStateToProps","state","ownProps","buildings"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { connect } from 'react-redux';\r\n//import _ from 'lodash';\r\n\r\nimport { fetchBuilding, selectPawn, changeMessage, selectSquare } from './../actions';\r\nimport data from './buildings.json';\r\nimport { message, GAME_PHASE, SCORING_PHASE } from './../constants';\r\nimport { calcScore } from './scoring';\r\nimport {rotateAndMirrorPattern} from './patternHandler'\r\n\r\n\r\nimport preparedPattern from './../trash/preparePattern'\r\nimport _ from 'lodash';\r\n\r\n\r\nclass Building extends React.Component {\r\n\r\n    selectBuilding() {\r\n\r\n        ///ДУБЛИРУЕТСЯ С КОДОМ ВЫШЕ - отличие в том, что тут берется только title от объекта!!!\r\n        const pointToIndex = arr => {\r\n            //move to x=1, y=1\r\n            const dx = Math.min(...arr.map(point => Number(point.x))) - 1;\r\n            const dy = Math.min(...arr.map(point => Number(point.y))) - 1;\r\n            arr.forEach(point => {\r\n                point.x -= dx;\r\n                point.y -= dy;\r\n            });\r\n            //[{x: \"1\", y: \"2\", resource: \"WOOD\"},...] -> [[12,\"WOOD\"],...]\r\n            return arr.map(point => {\r\n                const index = point.x.toString() + point.y.toString();\r\n                return [index, point.resource.title]\r\n                //and sort by index\r\n            }).sort((a, b) => { return a[0] - b[0] });\r\n        }\r\n\r\n        if (this.props.phase === GAME_PHASE) {\r\n\r\n            const pp = preparedPattern(this.props.selectedPattern, this.props.board)\r\n            const ppp = pointToIndex(pp);\r\n            let canSelectPawn = this.props.building.patterns.find(pattern => _.isEqual(pattern, ppp));\r\n            if (canSelectPawn) {\r\n                this.props.changeMessage(message.patternMatchesBuilding(this.props.building.title));\r\n                this.props.selectPawn(this.props.building);\r\n\r\n            } else {\r\n                this.props.selectPawn({});\r\n                this.props.selectSquare(null);\r\n                this.props.changeMessage(message.patternDoesNotMatchBuilding(this.props.building.title));\r\n            }\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        //upload data from json\r\n        const buildingForFetching = data[this.props.title];\r\n        //add all variants of the pattern\r\n        buildingForFetching.patterns = rotateAndMirrorPattern(buildingForFetching.pattern);\r\n        //load Building to the state\r\n        this.props.fetchBuilding(buildingForFetching);\r\n    }\r\n\r\n    renderScoring() {\r\n        if (this.props.phase === SCORING_PHASE) {\r\n            return calcScore[this.props.building.title](this.props.board)\r\n        };\r\n    }\r\n\r\n    renderPattern() {\r\n        const style = (col, row) => {\r\n            return {\r\n                gridColumn: col,\r\n                gridRow: row\r\n            }\r\n        }\r\n        return (\r\n            <>\r\n                {this.props.building.pattern.map(\r\n                    resource => <div key={resource[0]}\r\n                        className={`resource ${resource[1].toLowerCase()}`}\r\n                        style={style(resource[0] % 10, Math.floor(resource[0] / 10))}\r\n                    ></div>\r\n                )}\r\n            </>\r\n        );\r\n    }\r\n\r\n    render() {\r\n        if (!this.props.building) {\r\n            return null;\r\n        } else {\r\n            return (\r\n                <div className=\"building\">\r\n                    <div className=\"buildingTitle\">{this.props.building.title}\r\n                        <img src={`/images/${this.props.building.type}.png`} alt={this.props.building.type} />\r\n                    </div>\r\n                    <div className=\"buildingPattern\"> {this.renderPattern()} </div>\r\n                    <div className=\"buildingAbility\">{this.props.building.ability} </div>\r\n                    <button\r\n                        onClick={() => this.selectBuilding()}\r\n                        disabled={!(this.props.selectedPattern.length === this.props.building.pattern.length)}\r\n                    >\r\n                        Check the pattern\r\n                     </button>\r\n\r\n                    {this.renderScoring()}\r\n\r\n                </div>\r\n            );\r\n        }\r\n    }\r\n\r\n};\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n    return {\r\n        phase: state.phase,\r\n        building: state.buildings[ownProps.index],\r\n        selectedPattern: state.selectedPattern,\r\n        board: state.board\r\n    }\r\n};\r\n\r\nexport default connect(mapStateToProps, { fetchBuilding, selectPawn, changeMessage, selectSquare })(Building);\r\n"]},"metadata":{},"sourceType":"module"}